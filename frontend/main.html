<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Control System - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components/notifications.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="main-app">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon">üèóÔ∏è</div>
                        <div class="logo-text">–°–∏—Å—Ç–µ–º–∞–ö–æ–Ω—Ç—Ä–æ–ª—è</div>
                    </div>
                    <div class="auth-buttons" v-if="userProfile">
                        <span class="user-welcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ userProfile.full_name }}</span>
                        <span class="user-role" :class="userProfile.role">({{ getRoleName(userProfile.role) }})</span>
                        <button @click="logout" class="btn btn-primary">–í—ã–π—Ç–∏</button>
                    </div>
                </div>
            </div>
        </header>

        <main class="container">
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
            <div v-if="isLoading" class="loading-section">
                <div class="loading-spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div v-else class="dashboard">
                <!-- üëë –ü–ê–ù–ï–õ–¨ –ú–ï–ù–ï–î–ñ–ï–†–ê -->
                <div v-if="userProfile.role === 'manager'" class="manager-dashboard">
                    <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞</h1>
                    
                    <div class="stats-cards">
                        <div class="stat-card">
                            <h3>–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤</h3>
                            <div class="stat-number">{{ stats.totalProjects || 0 }}</div>
                        </div>
                        <div class="stat-card">
                            <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã</h3>
                            <div class="stat-number">{{ stats.activeDefects || 0 }}</div>
                        </div>
                        <div class="stat-card">
                            <h3>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</h3>
                            <div class="stat-number">{{ stats.completedDefects || 0 }}</div>
                        </div>
                        <div class="stat-card">
                            <h3>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</h3>
                            <div class="stat-number warning">{{ stats.overdueDefects || 0 }}</div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button @click="showCreateProject = true" class="btn btn-primary">
                            ‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
                        </button>
                        <button @click="showCreateDefect = true" class="btn btn-secondary">
                            üêõ –°–æ–∑–¥–∞—Ç—å –¥–µ—Ñ–µ–∫—Ç
                        </button>
                        <button @click="loadUsers" class="btn btn-info">
                            üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
                        </button>
                        <button @click="generateReport" class="btn btn-success">
                            üìä –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç
                        </button>
                    </div>

                    <!-- –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
                    <div class="quick-section">
                        <h2>–ü—Ä–æ–µ–∫—Ç—ã</h2>
                        <div class="projects-grid">
                            <div v-for="project in projects" :key="project.id" class="project-card">
                                <h4>{{ project.name }}</h4>
                                <p>{{ project.description }}</p>
                                <div class="project-meta">
                                    <span>–°—Ç–∞—Ç—É—Å: {{ project.status }}</span>
                                    <span>–î–µ—Ñ–µ–∫—Ç–æ–≤: {{ getProjectDefectsCount(project.id) }}</span>
                                </div>
                                <button @click="viewProject(project.id)" class="btn btn-small">
                                    –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- üë∑ –ü–ê–ù–ï–õ–¨ –ò–ù–ñ–ï–ù–ï–†–ê -->
                <div v-else-if="userProfile.role === 'engineer'" class="engineer-dashboard">
                    <h1>–†–∞–±–æ—á–∞—è –ø–∞–Ω–µ–ª—å –∏–Ω–∂–µ–Ω–µ—Ä–∞</h1>
                    
                    <div class="engineer-stats">
                        <div class="stat-card">
                            <h3>–ú–æ–∏ –¥–µ—Ñ–µ–∫—Ç—ã</h3>
                            <div class="stat-number">{{ getMyDefectsCount() }}</div>
                        </div>
                        <div class="stat-card">
                            <h3>–í —Ä–∞–±–æ—Ç–µ</h3>
                            <div class="stat-number">{{ getDefectsByStatus('–≤ —Ä–∞–±–æ—Ç–µ') }}</div>
                        </div>
                        <div class="stat-card">
                            <h3>–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</h3>
                            <div class="stat-number">{{ getDefectsByStatus('–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ') }}</div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button @click="showCreateDefect = true" class="btn btn-primary">
                            üêõ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ñ–µ–∫—Ç
                        </button>
                        <button @click="loadMyDefects" class="btn btn-secondary">
                            üìã –ú–æ–∏ –¥–µ—Ñ–µ–∫—Ç—ã
                        </button>
                        <button @click="showAllDefects = true" class="btn btn-info">
                            üëÄ –í—Å–µ –¥–µ—Ñ–µ–∫—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
                        </button>
                    </div>

                    <!-- –ú–æ–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã -->
                    <div class="quick-section">
                        <h2>–ú–æ–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>
                        <div v-if="myDefects.length > 0" class="defects-list">
                            <div v-for="defect in myDefects.slice(0, 5)" :key="defect.id" 
                                 class="defect-item" :class="defect.status">
                                <div class="defect-header">
                                    <h4>{{ defect.title }}</h4>
                                    <span class="defect-priority" :class="defect.priority">
                                        {{ defect.priority }}
                                    </span>
                                </div>
                                <p class="defect-desc">{{ defect.description }}</p>
                                <div class="defect-footer">
                                    <span>–°—Ç–∞—Ç—É—Å: {{ defect.status }}</span>
                                    <span>–°—Ä–æ–∫: {{ formatDate(defect.due_date) }}</span>
                                    <button @click="updateDefectStatus(defect.id)" class="btn btn-small">
                                        –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div v-else class="empty-state">
                            <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤</p>
                        </div>
                    </div>
                </div>

                <!-- üëÄ –ü–ê–ù–ï–õ–¨ –ù–ê–ë–õ–Æ–î–ê–¢–ï–õ–Ø -->
                <div v-else class="observer-dashboard">
                    <h1>–ü–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h1>
                    
                    <div class="observer-stats">
                        <div class="stat-card large">
                            <h3>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <span>–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤:</span>
                                    <strong>{{ stats.totalProjects || 0 }}</strong>
                                </div>
                                <div class="stat-item">
                                    <span>–í—Å–µ–≥–æ –¥–µ—Ñ–µ–∫—Ç–æ–≤:</span>
                                    <strong>{{ stats.totalDefects || 0 }}</strong>
                                </div>
                                <div class="stat-item">
                                    <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ:</span>
                                    <strong class="success">{{ stats.completedDefects || 0 }}</strong>
                                </div>
                                <div class="stat-item">
                                    <span>–í —Ä–∞–±–æ—Ç–µ:</span>
                                    <strong class="warning">{{ stats.activeDefects || 0 }}</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button @click="loadProjects" class="btn btn-primary">
                            üìÅ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤
                        </button>
                        <button @click="loadAllDefects" class="btn btn-secondary">
                            üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ñ–µ–∫—Ç–æ–≤
                        </button>
                        <button @click="generateReport" class="btn btn-success">
                            üìä –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç
                        </button>
                    </div>

                    <!-- –°–≤–æ–¥–∫–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º -->
                    <div class="quick-section">
                        <h2>–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤</h2>
                        <div class="projects-overview">
                            <div v-for="project in projects.slice(0, 3)" :key="project.id" class="project-overview-card">
                                <h4>{{ project.name }}</h3>
                                <div class="progress-bar">
                                    <div class="progress-fill" :style="{width: getProjectProgress(project.id) + '%'}"></div>
                                </div>
                                <div class="project-stats">
                                    <span>–î–µ—Ñ–µ–∫—Ç–æ–≤: {{ getProjectDefectsCount(project.id) }}</span>
                                    <span>–ó–∞–≤–µ—Ä—à–µ–Ω–æ: {{ getProjectCompletedCount(project.id) }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                <div class="user-card">
                    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h3>
                    <div class="user-info">
                        <div class="info-item">
                            <strong>Email:</strong> {{ userProfile.email }}
                        </div>
                        <div class="info-item">
                            <strong>–õ–æ–≥–∏–Ω:</strong> {{ userProfile.login }}
                        </div>
                        <div class="info-item">
                            <strong>–§–ò–û:</strong> {{ userProfile.full_name }}
                        </div>
                        <div class="info-item">
                            <strong>–†–æ–ª—å:</strong> 
                            <span class="role-badge" :class="userProfile.role">
                                {{ getRoleName(userProfile.role) }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ -->

        <footer>
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>–°–∏—Å—Ç–µ–º–∞–ö–æ–Ω—Ç—Ä–æ–ª—è</h3>
                        <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ—Ñ–µ–∫—Ç–∞–º–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤</p>
                    </div>
                    <div class="footer-section">
                        <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                        <p>Email: info@sistemakontrolya.ru</p>
                        <p>–¢–µ–ª–µ—Ñ–æ–Ω: +7 (XXX) XXX-XX-XX</p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2023 –û–û–û "–°–∏—Å—Ç–µ–º–∞–ö–æ–Ω—Ç—Ä–æ–ª—è". –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                </div>
            </div>
        </footer>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>